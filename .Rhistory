#  unliqd=obs-outlays
#total pipe=avail+expired-outlays
#unliuquid=obs-outlays
dplyr::mutate("unobligated"=available+expired-obligations)%>%
dplyr::mutate("unliquidated"=obligations-outlays)%>%
dplyr::mutate("pipeline_perct"=pipeline_total/available)%>%
dplyr::relocate(pipeline_perct, .before = unobligated)
df_fund_type_data<-df_all_data%>%
pivot_longer(cols=fy21q3:fy21q1,
names_to="period",
values_to="value")%>%
dplyr::group_by(program,period,type)%>%
summarise_at(vars(value), sum, na.rm = TRUE)%>%
ungroup()%>%
dplyr::filter(period=="fy21q3")%>%
filter(!program=="NA")%>%
pivot_wider(
names_from="type",
values_from=value)%>%
##Availabel+expired-obligations=unobligated
#  unliqd=obs-outlays
#total pipe=avail+expired-outlays
#unliuquid=obs-outlays
dplyr::mutate("unobligated"=available_net+expired-obligations)%>%
dplyr::mutate("unliquidated"=obligations-outlays)%>%
dplyr::mutate("pipeline_perct"=pipeline_total/available_net)%>%
dplyr::relocate(pipeline_perct, .before = unobligated)
df_fund_type_data%>%
dplyr::select(-(period))%>%
gt()%>%
cols_hide(
column = c(
"available":"pipeline_check"
))%>%
fmt_percent(
columns = c(`pipeline_perct`),
decimals = 2)%>%
fmt_currency( # add dolar signs
columns = c(`pipeline_total`,`unobligated`,`unliquidated`),
decimals = 0,
currency = "USD")%>%
tab_options(
table.font.names = "Source Sans Pro"
) %>%
cols_width(
everything() ~ px(140))%>%
cols_label(
program = "Program",
pipeline_total = "Pipeline Total",
pipeline_perct = "Pipeline Percent of Total Available",
unobligated="Unobligated",
unliquidated = "Unliquidated"
)%>%
tab_header(
title = glue::glue(" Fiscal Year 2021 Q2 Account Financial Performance Summary"))%>%
gt::tab_source_note("Create by EA Branch and Budget Branch")
get_pretty_budget_tables_fund_type<-function(df, periods=c("fy20q4","fy21q1","fy21q2","fy21q3","fy21q4")){
df<-df%>%
pivot_longer(cols=fy21q3:fy21q1,
names_to="period",
values_to="value")%>%
dplyr::group_by(program,period,type)%>%
summarise_at(vars(value), sum, na.rm = TRUE)%>%
ungroup()%>%
dplyr::filter(period %in% period )%>%
filter(!program=="NA")%>%
pivot_wider(
names_from="type",
values_from=value)%>%
##Availabel+expired-obligations=unobligated
#  unliqd=obs-outlays
#total pipe=avail+expired-outlays
#unliuquid=obs-outlays
dplyr::mutate("unobligated"=available_net+expired-obligations)%>%
dplyr::mutate("unliquidated"=obligations-outlays)%>%
dplyr::mutate("pipeline_perct"=pipeline_total/available_net)%>%
dplyr::relocate(pipeline_perct, .before = unobligated)
dplyr::select(-(period))%>%
gt()%>%
cols_hide(
column = c(
"available":"pipeline_check"
))%>%
fmt_percent(
columns = c(`pipeline_perct`),
decimals = 2)%>%
fmt_currency( # add dolar signs
columns = c(`pipeline_total`,`unobligated`,`unliquidated`),
decimals = 0,
currency = "USD")%>%
tab_options(
table.font.names = "Source Sans Pro"
) %>%
cols_width(
everything() ~ px(140))%>%
cols_label(
program = "Program",
pipeline_total = "Pipeline Total",
pipeline_perct = "Pipeline Percent of Total Available",
unobligated="Unobligated",
unliquidated = "Unliquidated"
)%>%
tab_header(
title = glue::glue(" Fiscal Year {periods} Account Financial Performance Summary"))%>%
gt::tab_source_note("Create by EA Branch and Budget Branch")
return(df)
}
get_pretty_budget_tables_fund_type(df, "fy21q3")
get_pretty_budget_tables_fund_type(df_all_data, "fy21q3")
df_all_data<-df_all_data%>%
pivot_longer(cols=fy21q3:fy21q1,
names_to="period",
values_to="value")%>%
dplyr::group_by(program,period,type)%>%
summarise_at(vars(value), sum, na.rm = TRUE)%>%
ungroup()
View(df_all_data)
get_pretty_budget_tables_fund_type<-function(df, periods=c("fy20q4","fy21q1","fy21q2","fy21q3","fy21q4")){
df<-df%>%
pivot_longer(cols=fy21q3:fy21q1,
names_to="period",
values_to="value")%>%
dplyr::group_by(program,period,type)%>%
summarise_at(vars(value), sum, na.rm = TRUE)%>%
ungroup()%>%
dplyr::filter(period %in% period )%>%
filter(!program=="NA")%>%
pivot_wider(
names_from="type",
values_from=value)%>%
##Availabel+expired-obligations=unobligated
#  unliqd=obs-outlays
#total pipe=avail+expired-outlays
#unliuquid=obs-outlays
dplyr::mutate("unobligated"=available_net+expired-obligations)%>%
dplyr::mutate("unliquidated"=obligations-outlays)%>%
dplyr::mutate("pipeline_perct"=pipeline_total/available_net)%>%
dplyr::relocate(pipeline_perct, .before = unobligated)%>%
dplyr::select(-(period))%>%
gt()%>%
cols_hide(
column = c(
"available":"pipeline_check"
))%>%
fmt_percent(
columns = c(`pipeline_perct`),
decimals = 2)%>%
fmt_currency( # add dolar signs
columns = c(`pipeline_total`,`unobligated`,`unliquidated`),
decimals = 0,
currency = "USD")%>%
tab_options(
table.font.names = "Source Sans Pro"
) %>%
cols_width(
everything() ~ px(140))%>%
cols_label(
program = "Program",
pipeline_total = "Pipeline Total",
pipeline_perct = "Pipeline Percent of Total Available",
unobligated="Unobligated",
unliquidated = "Unliquidated"
)%>%
tab_header(
title = glue::glue(" Fiscal Year {periods} Account Financial Performance Summary"))%>%
gt::tab_source_note("Create by EA Branch and Budget Branch")
return(df)
}
get_pretty_budget_tables_fund_type(df_all_data, "fy21q3")
View(df_all_data)
df_all_data<-full_join(df_fy21q3_report,df_fy21q2_report,by = c("fund_year", "fund", "program", "country_program", "type"))%>%
full_join(df_fy20q4_report,by = c("fund_year", "fund", "program", "country_program", "type"))%>%
full_join(df_fy21q1_report,by = c("fund_year", "fund", "program", "country_program", "type"))
df_all_data<-df_all_data%>%
mutate_at(vars(fy21q3,fy21q2,fy20q4,fy21q1),~replace_na(.,0))%>%
dplyr::mutate(country_program = dplyr::case_when(country_program    == "Democratic Republic of Congo"    ~"Democratic Republic of the Congo", #rename DRC
TRUE ~country_program))
get_pretty_budget_tables_fund_type(df_all_data, "fy21q3")
View(df_all_data)
df<-df_all_data%>%
pivot_longer(cols=fy21q3:fy21q1,
names_to="period",
values_to="value")%>%
dplyr::group_by(program,period,type)%>%
summarise_at(vars(value), sum, na.rm = TRUE)%>%
ungroup()%>%
dplyr::filter(period=="fy21q3" )%>%
filter(!program=="NA")%>%
pivot_wider(
names_from="type",
values_from=value)
View(df)
df<-df_all_data%>%
pivot_longer(cols=fy21q3:fy21q1,
names_to="period",
values_to="value")%>%
dplyr::group_by(program,period,type)%>%
summarise_at(vars(value), sum, na.rm = TRUE)%>%
ungroup()%>%
dplyr::filter(period=="fy21q3" )%>%
filter(!program=="NA")%>%
pivot_wider(
names_from="type",
values_from=value)%>%
##Availabel+expired-obligations=unobligated
#  unliqd=obs-outlays
#total pipe=avail+expired-outlays
#unliuquid=obs-outlays
dplyr::mutate("unobligated"=available_net+expired-obligations)%>%
dplyr::mutate("unliquidated"=obligations-outlays)%>%
dplyr::mutate("pipeline_perct"=pipeline_total/available_net)%>%
dplyr::relocate(pipeline_perct, .before = unobligated)%>%
dplyr::select(-(period))%>%
gt()%>%
cols_hide(
column = c(
"available":"pipeline_check"
))%>%
fmt_percent(
columns = c(`pipeline_perct`),
decimals = 2)%>%
fmt_currency( # add dolar signs
columns = c(`pipeline_total`,`unobligated`,`unliquidated`),
decimals = 0,
currency = "USD")%>%
tab_options(
table.font.names = "Source Sans Pro"
) %>%
cols_width(
everything() ~ px(140))%>%
cols_label(
program = "Program",
pipeline_total = "Pipeline Total",
pipeline_perct = "Pipeline Percent of Total Available",
unobligated="Unobligated",
unliquidated = "Unliquidated"
)%>%
tab_header(
title = glue::glue(" Fiscal Year {periods} Account Financial Performance Summary"))%>%
gt::tab_source_note("Create by EA Branch and Budget Branch")
df<-df_all_data%>%
pivot_longer(cols=fy21q3:fy21q1,
names_to="period",
values_to="value")%>%
dplyr::group_by(program,period,type)%>%
summarise_at(vars(value), sum, na.rm = TRUE)%>%
ungroup()%>%
dplyr::filter(period=="fy21q3" )%>%
filter(!program=="NA")%>%
pivot_wider(
names_from="type",
values_from=value)%>%
##Availabel+expired-obligations=unobligated
#  unliqd=obs-outlays
#total pipe=avail+expired-outlays
#unliuquid=obs-outlays
dplyr::mutate("unobligated"=available_net+expired-obligations)%>%
dplyr::mutate("unliquidated"=obligations-outlays)%>%
dplyr::mutate("pipeline_perct"=pipeline_total/available_net)%>%
dplyr::relocate(pipeline_perct, .before = unobligated)%>%
dplyr::select(-(period))%>%
gt()%>%
cols_hide(
column = c(
"available":"pipeline_check"
))%>%
fmt_percent(
columns = c(`pipeline_perct`),
decimals = 2)%>%
fmt_currency( # add dolar signs
columns = c(`pipeline_total`,`unobligated`,`unliquidated`),
decimals = 0,
currency = "USD")%>%
tab_options(
table.font.names = "Source Sans Pro"
) %>%
cols_width(
everything() ~ px(140))%>%
cols_label(
program = "Program",
pipeline_total = "Pipeline Total",
pipeline_perct = "Pipeline Percent of Total Available",
unobligated="Unobligated",
unliquidated = "Unliquidated"
)
df<-df_all_data%>%
pivot_longer(cols=fy21q3:fy21q1,
names_to="period",
values_to="value")%>%
dplyr::group_by(program,period,type)%>%
summarise_at(vars(value), sum, na.rm = TRUE)%>%
ungroup()%>%
dplyr::filter(period=="fy21q3" )%>%
filter(!program=="NA")%>%
pivot_wider(
names_from="type",
values_from=value)
View(df)
df<-df_all_data%>%
pivot_longer(cols=fy21q3:fy21q1,
names_to="period",
values_to="value")%>%
dplyr::group_by(program,period,type)%>%
summarise_at(vars(value), sum, na.rm = TRUE)%>%
ungroup()%>%
dplyr::filter(period=="fy21q3" )%>%
filter(!program=="NA")%>%
pivot_wider(
names_from="type",
values_from=value)%>%
##Availabel+expired-obligations=unobligated
#  unliqd=obs-outlays
#total pipe=avail+expired-outlays
#unliuquid=obs-outlays
dplyr::mutate("unobligated"=available_net+expired-obligations)%>%
dplyr::mutate("unliquidated"=obligations-outlays)%>%
dplyr::mutate("pipeline_perct"=pipeline_total/available_net)%>%
dplyr::relocate(pipeline_perct, .before = unobligated)%>%
dplyr::select(-(period))%>%
gt()
df<-df_all_data%>%
pivot_longer(cols=fy21q3:fy21q1,
names_to="period",
values_to="value")%>%
dplyr::group_by(program,period,type)%>%
summarise_at(vars(value), sum, na.rm = TRUE)%>%
ungroup()%>%
dplyr::filter(period=="fy21q3" )%>%
filter(!program=="NA")%>%
pivot_wider(
names_from="type",
values_from=value)%>%
##Availabel+expired-obligations=unobligated
#  unliqd=obs-outlays
#total pipe=avail+expired-outlays
#unliuquid=obs-outlays
dplyr::mutate("unobligated"=available_net+expired-obligations)%>%
dplyr::mutate("unliquidated"=obligations-outlays)%>%
dplyr::mutate("pipeline_perct"=pipeline_total/available_net)%>%
dplyr::relocate(pipeline_perct, .before = unobligated)%>%
dplyr::select(-(period))%>%
gt()%>%
cols_hide(
column = c(
"available":"pipeline_check"
))
df<-df_all_data%>%
pivot_longer(cols=fy21q3:fy21q1,
names_to="period",
values_to="value")%>%
dplyr::group_by(program,period,type)%>%
summarise_at(vars(value), sum, na.rm = TRUE)%>%
ungroup()%>%
dplyr::filter(period=="fy21q3" )%>%
filter(!program=="NA")%>%
pivot_wider(
names_from="type",
values_from=value)%>%
##Availabel+expired-obligations=unobligated
#  unliqd=obs-outlays
#total pipe=avail+expired-outlays
#unliuquid=obs-outlays
dplyr::mutate("unobligated"=available_net+expired-obligations)%>%
dplyr::mutate("unliquidated"=obligations-outlays)%>%
dplyr::mutate("pipeline_perct"=pipeline_total/available_net)%>%
dplyr::relocate(pipeline_perct, .before = unobligated)%>%
dplyr::select(-(period))%>%
gt()%>%
cols_hide(
column = c(
"available":"pipeline_check"
))%>%
fmt_percent(
columns = c(`pipeline_perct`),
decimals = 2)%>%
fmt_currency( # add dolar signs
columns = c(`pipeline_total`,`unobligated`,`unliquidated`),
decimals = 0,
currency = "USD")%>%
tab_options(
table.font.names = "Source Sans Pro"
) %>%
cols_width(
everything() ~ px(140))%>%
cols_label(
program = "Program",
pipeline_total = "Pipeline Total",
pipeline_perct = "Pipeline Percent of Total Available",
unobligated="Unobligated",
unliquidated = "Unliquidated"
)
df<-df_all_data%>%
pivot_longer(cols=fy21q3:fy21q1,
names_to="period",
values_to="value")%>%
dplyr::group_by(program,period,type)%>%
summarise_at(vars(value), sum, na.rm = TRUE)%>%
ungroup()%>%
dplyr::filter(period=="fy21q3" )%>%
filter(!program=="NA")%>%
pivot_wider(
names_from="type",
values_from=value)%>%
##Availabel+expired-obligations=unobligated
#  unliqd=obs-outlays
#total pipe=avail+expired-outlays
#unliuquid=obs-outlays
dplyr::mutate("unobligated"=available_net+expired-obligations)%>%
dplyr::mutate("unliquidated"=obligations-outlays)%>%
dplyr::mutate("pipeline_perct"=pipeline_total/available_net)%>%
dplyr::relocate(pipeline_perct, .before = unobligated)%>%
dplyr::select(-(period))%>%
gt()%>%
cols_hide(
column = c(
"available":"pipeline_check"
))%>%
fmt_percent(
columns = c(`pipeline_perct`),
decimals = 2)%>%
fmt_currency( # add dolar signs
columns = c(`pipeline_total`,`unobligated`,`unliquidated`),
decimals = 0,
currency = "USD")%>%
tab_options(
table.font.names = "Source Sans Pro"
) %>%
cols_width(
everything() ~ px(140))%>%
cols_label(
program = "Program",
pipeline_total = "Pipeline Total",
pipeline_perct = "Pipeline Percent of Total Available",
unobligated="Unobligated",
unliquidated = "Unliquidated"
)
df<-df_all_data%>%
pivot_longer(cols=fy21q3:fy21q1,
names_to="period",
values_to="value")%>%
dplyr::group_by(program,period,type)%>%
summarise_at(vars(value), sum, na.rm = TRUE)%>%
ungroup()%>%
dplyr::filter(period=="fy21q3" )%>%
filter(!program=="NA")%>%
pivot_wider(
names_from="type",
values_from=value)%>%
##Availabel+expired-obligations=unobligated
#  unliqd=obs-outlays
#total pipe=avail+expired-outlays
#unliuquid=obs-outlays
dplyr::mutate("unobligated"=available_net+expired-obligations)%>%
dplyr::mutate("unliquidated"=obligations-outlays)%>%
dplyr::mutate("pipeline_perct"=pipeline_total/available_net)%>%
dplyr::relocate(pipeline_perct, .before = unobligated)%>%
dplyr::select(-(period))
View(df)
get_pretty_budget_tables_fund_type<-function(df, periods=c("fy20q4","fy21q1","fy21q2","fy21q3","fy21q4")){
df<-df_all_data%>%
pivot_longer(cols=fy21q3:fy21q1,
names_to="period",
values_to="value")%>%
dplyr::group_by(program,period,type)%>%
summarise_at(vars(value), sum, na.rm = TRUE)%>%
ungroup()%>%
dplyr::filter(period=="fy21q3" )%>%
filter(!program=="NA")%>%
pivot_wider(
names_from="type",
values_from=value)%>%
##Availabel+expired-obligations=unobligated
#  unliqd=obs-outlays
#total pipe=avail+expired-outlays
#unliuquid=obs-outlays
dplyr::mutate("unobligated"=available_net+expired-obligations)%>%
dplyr::mutate("unliquidated"=obligations-outlays)%>%
dplyr::mutate("pipeline_perct"=pipeline_total/available_net)%>%
dplyr::relocate(pipeline_perct, .before = unobligated)%>%
dplyr::select(-(period))%>%
gt()%>%
cols_hide(
column = c(
"available":"pipeline_check"
))%>%
fmt_percent(
columns = c(`pipeline_perct`),
decimals = 2)%>%
fmt_currency( # add dolar signs
columns = c(`pipeline_total`,`unobligated`,`unliquidated`),
decimals = 0,
currency = "USD")%>%
tab_options(
table.font.names = "Source Sans Pro"
) %>%
cols_width(
everything() ~ px(140))%>%
cols_label(
program = "Program",
pipeline_total = "Pipeline Total",
pipeline_perct = "Pipeline Percent of Total Available",
unobligated="Unobligated",
unliquidated = "Unliquidated"
)%>%
tab_header(
title = glue::glue(" Fiscal Year {periods} Account Financial Performance Summary"))%>%
gt::tab_source_note("Create by EA Branch and Budget Branch")
return(df)
}
get_pretty_budget_tables_fund_type(df_all_data,"fy21q2")
get_pretty_budget_tables_fund_type(df_all_data,"fy21q3")
get_pretty_budget_tables_fund_type(df_all_data,"fy21q1")
